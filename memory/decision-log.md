## 2025-12-04

- Se implementó integración cliente con `POST /api/routes/generate` utilizando `Dio` con inyección de token.
- Se actualizó `GenerationModal` para devolver horas seleccionadas como entero.
- Se añadió `GeneratedRoutesModal` para mostrar las rutas generadas con botón "Comenzar ruta" sin funcionalidad.
- Se documentó el endpoint en `docs/api/routes_generate.md`.
 - Se corrigió cálculo de distancias y ETA: creación de `GeoUtils` con Haversine en metros; `NavigationRepository` ahora usa `driving-traffic` y elimina mocks forzados; fallback calcula distancia y duración por velocidad promedio.
- Se agregó integración con `GET /api/recommender/recommend`: nuevos modelos `Recommendation` y `RecommendResponse`, cliente `RecommenderApi`, y `RecommenderRepository` con caché y reintentos.
- Provider `HomeProvider` ahora carga recomendaciones al iniciar y expone estados de carga y error.
- UI del panel de inicio muestra joyas ocultas, basadas en rutas y destacados con datos reales.
 - Rediseño del panel de recomendaciones: tarjetas horizontales con `ListView.separated`, truncado con elipsis y componentes reutilizables (`RecommendationCard`) para evitar overflows.
- Se alinearon las secciones con el API: se muestran solo "Gemas ocultas destacadas" (is_hidden_gem) y "Recomendadas para ti" (resto), eliminando bloques no presentes en la respuesta.
- Simplificación final: una única sección "Recomendaciones para ti" con lista vertical usando `RecommendationListItem`, ordenada por `final_score`.
 - Se añadió botón "Ir" por cada recomendación para generar ruta al destino: se obtiene el `Place` por `place_id`, se calcula ruta con `NavigationProvider` y se activa la pestaña de mapa.
- Decisión: mostrar el nombre del lugar junto al ícono del marcador usando `PointAnnotationOptions.textField`, `textOffset`, `textColor`, `textHaloColor` y `textHaloWidth` en Mapbox. Se mantiene el fallback de `CircleAnnotation` (sin texto) para casos donde el manager de puntos no esté disponible.
- Ajuste: separar la carga del ícono de la creación del `PointAnnotationManager` para evitar fallback a círculos cuando falte el asset. Fallback a `iconImage: 'marker-15'` si no hay bytes de imagen. Nota: `textAllowOverlap`/`iconAllowOverlap` no existen en `PointAnnotationOptions`; si se necesita control de colisiones, se debe usar `SymbolLayer`.
- Cambio: se crean ambos managers (puntos y círculos) y se renderiza círculo + etiqueta simultáneamente. La etiqueta se dibuja con `PointAnnotation` sin ícono; el círculo con `CircleAnnotation` mantiene el estilo de distinción visual.
- Cambio: se crean ambos managers (puntos y círculos) y se renderiza círculo + etiqueta simultáneamente. La etiqueta se dibuja con `PointAnnotation` sin ícono; el círculo con `CircleAnnotation` mantiene el estilo de distinción visual. Se elimina el campo `_markerBytes` no usado y se reemplaza el uso de `Color.value` por `toARGB32()` para evitar deprecaciones.
 - Decisión: finalizar navegación automáticamente al detectar llegada usando `remainingDistanceMeters` con umbral de 25 m; se añade `hasArrived` y `endRoute` en `NavigationProvider`.
 - Decisión: añadir botón manual "Finalizar ruta" en `HomePage` para permitir cierre explícito de la navegación.
- Verificación: prueba unitaria dedicada ejecutada solo sobre el provider para no depender de variables de entorno.
 - Decisión: recortar la polilínea activa en cada actualización de posición para eliminar tramos recorridos; actualización solo cuando avanza el índice para evitar coste innecesario.
 - Decisión: mejorar suavidad del seguimiento bajando `distanceFilter` a 3 m y el throttle de cámara a 300 ms, manteniendo control de recursos.
